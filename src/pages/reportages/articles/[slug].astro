---
import Layout from '@/layouts/Layout.astro';
import { formatDate } from '@/utils/formatDate';
import type { ArticleInterface } from '@/@types/types';
import articles from '@/data/articles.json';
import GalleryWithCarousel from '@/components/pictures/GalleryWithCarousel.astro';
import { IoIosArrowBack } from 'react-icons/io';

// docs.astro.build/en/guides/on-demand-rendering/
export const prerender = true;

const BackIcon = IoIosArrowBack;

export async function getStaticPaths() {
  return articles.map((article: ArticleInterface) => ({
    params: { slug: article.slug },
    props: { article }
  }));
}

const { article } = Astro.props as { article: ArticleInterface };
if (!article) {
  return Astro.redirect('/404');
}
---

<Layout>
  <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-16 space-y-12">
    <a
      href="/reportages/articles"
      class="inline-flex items-center text-sm text-gray-600 hover:text-gray-900 transition-colors"
    >
      <BackIcon />
      <span>Retour aux articles</span>
    </a>
    <article class="space-y-6">
      <header class="text-center space-y-2">
        <h1 class="text-5xl font-bold leading-tight">{article.title}</h1>
        <p class="text-sm text-gray-500">
          Par {article.author} â€¢ {formatDate(article.date)}
        </p>
        {
          article.summary && (
            <p class="text-gray-700 text-lg sm:text-xl max-w-3xl mx-auto italic">
              {article.summary}
            </p>
          )
        }
      </header>
      {
        article.pictures?.length > 0 && (
          <section class="mt-8">
            <GalleryWithCarousel pictures={article.pictures} />
          </section>
        )
      }

      <section class="prose max-w-4xl mx-auto text-gray-800 leading-relaxed">
        <p>{article.content}</p>
      </section>
    </article>
  </div>
</Layout>
