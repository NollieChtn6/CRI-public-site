---
import Layout from '@/layouts/Layout.astro';
import { formatDate } from '@/utils/formatDate';
import type { ArticleInterface } from '@/@types/types';
import articles from '@/data/articles.json';
import GalleryWithCarousel from '@/components/pictures/GalleryWithCarousel.astro';
import { IoIosArrowBack } from 'react-icons/io';

// docs.astro.build/en/guides/on-demand-rendering/
export const prerender = true;

const BackIcon = IoIosArrowBack;

export async function getStaticPaths() {
  return articles.map((article: ArticleInterface) => ({
    params: { slug: article.slug },
    props: { article }
  }));
}

const { article } = Astro.props as { article: ArticleInterface };
if (!article) {
  return Astro.redirect('/404');
}
---

<Layout>
  <a href="/reportages/articles" class="flex space-x-2 items-center text-sm"
    ><BackIcon /><span>Retour aux articles</span></a
  >
  <article class="max-w-5xl px-4 py-4 space-y-4">
    <header class="space-y-4">
      <h1 class="text-4xl font-bold">{article.title}</h1>
      <p class="text-sm text-gray-500">
        Par {article.author} â€¢ {formatDate(article.date)}
      </p>
      <p>{article.summary}</p>
    </header>
  </article>

  {
    article.pictures?.length > 0 && (
      <section class="px-4 md:px-8 lg:px-16">
        <GalleryWithCarousel pictures={article.pictures} />
      </section>
    )
  }
  <section class="py-4 px-4">
    <p>{article.content}</p>
  </section>
</Layout>
