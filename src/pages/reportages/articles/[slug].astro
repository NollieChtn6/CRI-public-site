---
import Layout from '@/layouts/Layout.astro';
import { formatDate } from '@/utils/formatDate';
import type { ArticleInterface } from '@/@types/types';
import articles from '@/data/articles.json';
import GalleryWithCarousel from '@/components/pictures/GalleryWithCarousel.astro';
import { IoIosArrowBack } from 'react-icons/io';

// docs.astro.build/en/guides/on-demand-rendering/
export const prerender = true;

const BackIcon = IoIosArrowBack;

export async function getStaticPaths() {
  return articles.map((article: ArticleInterface) => ({
    params: { slug: article.slug },
    props: { article }
  }));
}

const { article } = Astro.props as { article: ArticleInterface };
if (!article) {
  return Astro.redirect('/404');
}
const authorsList = article.authors.join(', ');
---

<Layout>
  <div
    class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12 space-y-8 text-shark-100"
  >
    <a href="/reportages/articles" class="back-button">
      <BackIcon />
      <span>Retour aux articles</span>
    </a>

    <article class="space-y-8">
      <header class="text-center space-y-4">
        <h1
          class="text-4xl sm:text-5xl font-bold leading-tight text-red-orange-500"
        >
          {article.title}
        </h1>

        <p class="text-sm text-shark-400">
          Crédits photo&nbsp;: {authorsList}
        </p>

        <div class="flex justify-center mt-1">
          <span class="text-xs text-shark-500"
            >Publié le {formatDate(article.date)}</span
          >
        </div>

        {
          article.summary && (
            <p class="text-shark-100 text-lg sm:text-xl max-w-3xl mx-auto italic mt-2">
              {article.summary}
            </p>
          )
        }
      </header>
      <section
        class="prose max-w-4xl mx-auto text-shark-100 leading-relaxed space-y-4"
      >
        {article.content.split('\n').map((paragraph, i) => <p>{paragraph}</p>)}
      </section>
    </article>
    {
      article.pictures?.length > 0 && (
        <section class="mt-6">
          <GalleryWithCarousel
            pictures={article.pictures}
            class="rounded-xl shadow-md"
            type="article"
          />
        </section>
      )
    }
  </div>
</Layout>
