---
import Layout from '@/layouts/Layout.astro';
import { formatDate } from '@/utils/formatDate';
import type { GalleryInterface } from '@/@types/types';
import galleries from '@/data/galleries.json';
import GalleryWithCarousel from '@/components/pictures/GalleryWithCarousel.astro';
import { IoIosArrowBack } from 'react-icons/io';
import Tag from '@/atoms/Tag.astro';

export const prerender = true;

const BackIcon = IoIosArrowBack;

export async function getStaticPaths() {
  return galleries.map((gallery: GalleryInterface) => ({
    params: { slug: gallery.slug },
    props: { gallery }
  }));
}

const { gallery } = Astro.props as { gallery: GalleryInterface };
if (!gallery) {
  return Astro.redirect('/404');
}
---

<Layout>
  <div
    class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12 space-y-8 text-shark-100"
  >
    <a
      href={`/reportages/galeries/${gallery.tag}`}
      class="inline-flex items-center text-sm text-dark-blue-400 hover:text-dark-blue-500 transition-colors mb-4"
    >
      <BackIcon />
      <span>Retour aux reportages</span>
    </a>
    <article class="space-y-8">
      <header class="text-center space-y-4">
        <h1
          class="text-4xl sm:text-5xl font-bold leading-tight text-red-orange-500"
        >
          {gallery.title} ({gallery.department})
        </h1>
        <p class="text-sm text-shark-400">Par {gallery.authors.join(', ')}</p>

        <div class="flex justify-center items-center gap-2 mt-1">
          <span class="text-xs text-shark-500"
            >Publi√© le {formatDate(gallery.date)} dans
          </span>
          <Tag
            label={gallery.tag}
            url={`/reportages/galeries/${gallery.tag}`}
            class="inline-block"
          />
        </div>

        {
          gallery.description && (
            <p class="text-shark-100 text-lg sm:text-xl max-w-3xl mx-auto italic">
              {gallery.description}
            </p>
          )
        }
      </header>
      {
        gallery.pictures?.length > 0 && (
          <section class="mt-6">
            <GalleryWithCarousel
              pictures={gallery.pictures}
              class="rounded-xl shadow-md"
            />
          </section>
        )
      }

      <section
        class="prose max-w-4xl mx-auto text-shark-100 leading-relaxed space-y-4"
      >
        {gallery.content.split('\n').map((paragraph, i) => <p>{paragraph}</p>)}
      </section>
    </article>
  </div>
</Layout>
