---
// src/pages/index.astro
import PublicationsSection from '@/components/PublicationsSection.astro';
import Layout from '../layouts/Layout.astro';
import type { Picture, ArticleFrontmatter } from '@/@types/types';
import type { MarkdownInstance } from 'astro';
import HeroCarousel from '@/components/pictures/hero/HeroCarousel.astro';
import articles from '@/data/articles.json';

const modules: Record<
  string,
  MarkdownInstance<ArticleFrontmatter>
> = import.meta.glob('/src/data/prevention/*.md', { eager: true });

const preventionArticles = Object.values(modules)
  .map((mod) => ({
    slug: mod.frontmatter.slug,
    title: mod.frontmatter.title,
    authors: mod.frontmatter.authors ?? [],
    date: mod.frontmatter.date,
    summary: mod.frontmatter.summary ?? '',
    content: mod.default,
    coverPictureUrl: mod.frontmatter.coverPictureUrl ?? '',
    coverPictureAlt: mod.frontmatter.coverPictureAlt ?? '',
    tags: mod.frontmatter.tags ?? []
  }))
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
  .slice(0, 6);

const latestArticles = [...articles]
  .filter((article) => article.tags.includes('reportages'))
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
  .slice(0, 6);

const HERO_PICTURES: Picture[] = [
  {
    url: 'https://picsum.photos/900/600?1',
    alt: 'Intervention de secours',
    author: 'John Doe'
  },
  {
    url: 'https://picsum.photos/900/600?2',
    alt: 'Exercice de sécurité civile',
    author: 'Jane Smith'
  },
  {
    url: 'https://picsum.photos/900/600?3',
    alt: 'Opération de terrain',
    author: 'Alice Johnson'
  }
];
---

<Layout>
  <section
    class="hero-section flex flex-col lg:flex-row items-center justify-center px-6 md:px-16 py-16 min-h-[calc(100vh-7.5rem)] gap-12 md:gap-16"
  >
    <div
      class="flex flex-col justify-center space-y-6 max-w-lg text-center md:text-left"
    >
      <h1
        class="text-4xl md:text-5xl font-bold leading-tight uppercase text-red-orange-500"
      >
        Code Rouge Info
      </h1>

      <p class="text-shark-200 text-base lg:text-xl">
        Association française loi 1901, Code Rouge Info valorise le travail des
        intervenants de la Sécurité Civile et de la Défense à travers des
        reportages photo et vidéo, et sensibilise le grand public aux situations
        d&rsquo;urgence et aux risques naturels.
      </p>

      <div>
        <a href="association/a-propos" class="nav-button">Notre histoire</a>
      </div>
    </div>
    <div class="flex justify-center items-center w-full md:w-1/2">
      <HeroCarousel pictures={HERO_PICTURES} />
    </div>
  </section>

  <PublicationsSection
    title="Prévention — Feux de forêts"
    articles={preventionArticles}
    section="prevention"
  />
  <PublicationsSection
    title="Nos reportages"
    articles={latestArticles}
    section="reportages"
  />
</Layout>
