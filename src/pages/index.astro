---
import PublicationsSection from '@/components/PublicationsSection.astro';
import Layout from '../layouts/Layout.astro';
import type { Picture, ArticleFrontmatter } from '@/@types/types';
import type { MarkdownInstance } from 'astro';
import HeroCarousel from '@/components/pictures/hero/HeroCarousel.astro';
import articles from '@/data/articles.json';
import HERO_PICTURES from '@/data/pictures.json';

const modules: Record<
  string,
  MarkdownInstance<ArticleFrontmatter>
> = import.meta.glob('/src/data/prevention/*.md', { eager: true });

const preventionArticles = Object.values(modules)
  .map((mod) => ({
    slug: mod.frontmatter.slug,
    title: mod.frontmatter.title,
    authors: mod.frontmatter.authors ?? [],
    date: mod.frontmatter.date,
    summary: mod.frontmatter.summary ?? '',
    content: mod.default,
    coverPictureUrl: mod.frontmatter.coverPictureUrl ?? '',
    coverPictureAlt: mod.frontmatter.coverPictureAlt ?? '',
    tags: mod.frontmatter.tags ?? []
  }))
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
  .slice(0, 6);

const latestArticles = [...articles]
  .filter((article) => article.tags.includes('reportages'))
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
  .slice(0, 6);
---

<Layout>
  <section
    class="hero-section flex flex-col lg:flex-row items-center justify-center
           px-6 md:px-16
           py-12 md:py-16
           min-h-[70vh] lg:min-h-[calc(100vh-7.5rem)]
           gap-10 lg:gap-16"
  >
    <div
      class="flex flex-col justify-center space-y-4 lg:space-y-6
             w-full lg:max-w-lg
             text-center lg:text-left"
    >
      <h1
        class="text-[2.2rem] sm:text-[2.6rem] md:text-[3rem] lg:text-5xl
               font-bold leading-snug md:leading-tight
               uppercase text-red-orange-500"
      >
        Code Rouge Info
      </h1>

      <p
        class="text-shark-200 text-[0.95rem] sm:text-sm md:text-base lg:text-lg xl:text-xl leading-relaxed"
      >
        Association française loi&nbsp;1901, Code&nbsp;Rouge&nbsp;Info valorise
        le travail des intervenants de la Sécurité Civile et de la Défense à
        travers des reportages photo et vidéo, et sensibilise le grand public
        aux risques naturels.
      </p>

      <div class="pt-2">
        <a href="association/a-propos" class="nav-button inline-block">
          Notre histoire
        </a>
      </div>
    </div>

    <div
      class="flex justify-center items-center
             w-full lg:w-1/2
             max-w-md sm:max-w-lg lg:max-w-none"
    >
      <HeroCarousel pictures={HERO_PICTURES} />
    </div>
  </section>

  <PublicationsSection
    title="Prévention — Feux d'espaces naturels"
    articles={preventionArticles}
    section="prevention"
  />
  <PublicationsSection
    title="Nos reportages"
    articles={latestArticles}
    section="reportages"
  />
</Layout>
